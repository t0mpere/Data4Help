extends layout

block content
    body
        if auth
            script.
                //load table
                function loadTable(input){
                    $.post( "/bc/accessRequest", { email:input.name }, function (data) {

                        var html = '';
                        for (var i = 0; i < data.res.length; i++){
                            html += '<tr><td>' + data.res[i]._hearthRate +
                                '</td><td>' + data.res[i]._minBloodPressure + '</td>' +
                                '</td><td>' + data.res[i]._maxBloodPressure + '</td>' +
                                '</td><td>' + data.res[i]._lat + '</td>' +
                                '</td><td>' + data.res[i]._long + '</td>' +
                                '</td><td>' + data.res[i]._timeOfAcquisition + '</td>' +
                                '</tr>';
                        }

                        document.getElementById("result").innerHTML = html
                        drawGraph(data);
                    } );
                }
                function drawGraph(data) {
                    //chart config
                    $('#chart').remove(); // this is my <canvas> element
                    $('#chart-container').append('<canvas id="chart"><canvas>');
                    let ctx = document.getElementById("chart").getContext('2d');
                    let myChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.res.map(function (value) {
                                return value._timeOfAcquisition;
                            }),
                            datasets: [{
                                label: 'Hearth Rate',
                                backgroundColor: 'rgba(215, 44, 44, 0.6)',
                                data: data.res.map(function (value, index) {
                                    return value._hearthRate;
                                })},
                                {
                                    label: 'Minimum Blood Pressure',
                                    backgroundColor: 'rgba(63, 154, 195, 1)',
                                    data: data.res.map(function (value, index) {
                                        return value._minBloodPressure;
                                    })
                                },
                                {
                                    label: 'Maximum Blood Pressure',
                                    backgroundColor: 'rgba(63, 255, 126, 1)',
                                    data: data.res.map(function (value, index) {
                                        return value._maxBloodPressure;
                                    })
                                }]
                        },
                        options: {
                            scales: {
                                xAxes:[{
                                    stacked: true,
                                    ticks: {
                                        beginAtZero: true
                                    }
                                }],
                                yAxes: [{

                                    ticks: {
                                        beginAtZero: true
                                    }
                                }]
                            }
                        }
                    });
                }
            .container-fluid
                .row(style = 'padding: 20px')
                    .col-md-8(style = 'padding: 20px').jumbotron
                        #chart-container
                            canvas#chart
                        table.table.table-light
                            thead
                                tr
                                    th
                                        | Hearth Rate
                                    th
                                        | Minimum Blood Pressure
                                    th
                                        | Maximum Blood Pressure
                                    th
                                        | Latitude
                                    th
                                        | Longitude
                                    th
                                        | Time Of Acquisition
                            tbody#result.table-primary
                    .col-md-4(style = 'padding: 20px;')
                        h3.font-italic Private Requests:
                        .list-group
                            unless privateRequests === undefined
                                each val in privateRequests
                                    if val.accepted
                                        a.list-group-item.active.font-italic.font-weight-bold(href='#', name = val.PrivateCustomers_email, onclick = 'loadTable(this)')= val.PrivateCustomers_email
                                            span.badge.badge-success.badge-pill Accepted
                                    else
                                        a.list-group-item.disabled(role="button", name = val.PrivateCustomers_email)= val.PrivateCustomers_email
                                            span.badge.badge-danger.badge-pill Pending
                            else
                                h2 No private requests yet.
                        a.btn.btn-primary.btn-block.btn-lg.top-padding(href = '/bc/accessRequest/makeRequest')
                            | Make New Request


        else
            h1 Login to use this function
